# libevent
## libeventä»‹ç»
>Libevent æ˜¯ä¸€ä¸ªç”¨Cè¯­è¨€ç¼–å†™çš„ã€è½»é‡çº§çš„å¼€æºé«˜æ€§èƒ½äº‹ä»¶é€šçŸ¥åº“ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªäº®ç‚¹ï¼šäº‹ä»¶é©±åŠ¨ï¼ˆ event-drivenï¼‰ï¼Œé«˜æ€§èƒ½;è½»é‡çº§ï¼Œä¸“æ³¨äºç½‘ç»œï¼Œä¸å¦‚ ACE é‚£ä¹ˆè‡ƒè‚¿åºå¤§ï¼›æºä»£ç ç›¸å½“ç²¾ç‚¼ã€æ˜“è¯»ï¼›è·¨å¹³å°ï¼Œæ”¯æŒ Windowsã€ Linuxã€ *BSD å’Œ Mac Osï¼›æ”¯æŒå¤šç§ I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œ epollã€ pollã€ dev/pollã€ select å’Œ kqueue ç­‰ï¼›æ”¯æŒ I/Oï¼Œå®šæ—¶å™¨å’Œä¿¡å·ç­‰äº‹ä»¶ï¼›æ³¨å†Œäº‹ä»¶ä¼˜å…ˆçº§ã€‚
Libevent å·²ç»è¢«å¹¿æ³›çš„åº”ç”¨ï¼Œä½œä¸ºåº•å±‚çš„ç½‘ç»œåº“ï¼›æ¯”å¦‚ memcachedã€ Vomitã€ Nylonã€ Netchatç­‰ç­‰ã€‚(ç™¾åº¦ç™¾ç§‘)
## ç‰¹ç‚¹
>äº‹ä»¶é©±åŠ¨ï¼Œé«˜æ€§èƒ½ï¼›
è½»é‡çº§ï¼Œä¸“æ³¨äºç½‘ç»œï¼›
è·¨å¹³å°ï¼Œæ”¯æŒ Windowsã€Linuxã€Mac Osç­‰ï¼›
æ”¯æŒå¤šç§ I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œ epollã€pollã€dev/pollã€select å’Œkqueue ç­‰ï¼›
æ”¯æŒ I/Oï¼Œå®šæ—¶å™¨å’Œä¿¡å·ç­‰äº‹ä»¶ï¼›
## ç»„æˆ
>äº‹ä»¶ç®¡ç†åŒ…æ‹¬å„ç§IOï¼ˆsocketï¼‰ã€å®šæ—¶å™¨ã€ä¿¡å·ç­‰äº‹ä»¶ï¼Œä¹Ÿæ˜¯libeventåº”ç”¨æœ€å¹¿çš„æ¨¡å—ï¼›
ç¼“å­˜ç®¡ç†æ˜¯æŒ‡evbufferåŠŸèƒ½ï¼›
DNSæ˜¯libeventæä¾›çš„ä¸€ä¸ªå¼‚æ­¥DNSæŸ¥è¯¢åŠŸèƒ½ï¼›
HTTPæ˜¯libeventçš„ä¸€ä¸ªè½»é‡çº§httpå®ç°ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯
## æ¡ˆä¾‹
### IOäº‹ä»¶
å½“ç®¡é“ä¸­ä¸€è¾¹å†™å…¥æ—¶ï¼Œå¦ä¸€åŠå³å¯è¯»<br>
æ–‡ä»¶åŒ…æ‹¬`eventlisten.c`å’Œ`wirtefifo.c`<br><br>
`eventlisten.c`åˆ›å»ºç®¡é“ï¼Œå¹¶æŒç»­ç›‘å¬äº‹ä»¶é›†åˆï¼Œå½“å‘ç”Ÿå†™å…¥äº‹ä»¶æ—¶ï¼Œè°ƒç”¨å›è°ƒå‡½æ•°è¯»å–å†™å…¥å†…å®¹å¹¶è¾“å‡º<br>
![image](https://github.com/LLKI/libevent-/assets/92627079/cef72e67-6e8c-4911-9f6e-b90ea46027d3)<br>
#### apiè°ƒç”¨é¡ºåº(å…·ä½“å‚æ•°ä½¿ç”¨Source InsightæŸ¥çœ‹æºç )
1. åˆ›å»ºç®¡é“:mkfifo
2. ä½¿ç”¨openæ‰“å¼€ç®¡é“ï¼Œåˆ›å»ºæ–‡ä»¶æè¿°ç¬¦fd
3. event_init():åˆå§‹åŒ–äº‹ä»¶é›†åˆ
4. struct event ev:åˆ›å»ºäº‹ä»¶
5. event_set:åˆå§‹åŒ–äº‹ä»¶(ç»‘å®ševå’Œfd,æŒ‡å®šäº‹ä»¶ç±»å‹ï¼Œç»‘å®šå›è°ƒå‡½æ•°)ï¼Œæœ¬è´¨æ˜¯è°ƒç”¨event_assign
6. event_add:æŠŠäº‹ä»¶æ·»åŠ åˆ°é›†åˆä¸­
7. event_dispatch:ç›‘å¬ç®¡é“

`wirtefifo.c`æ‰“å¼€ç®¡é“ï¼Œç­‰å¾…è¾“å…¥ï¼Œå°†è¾“å…¥å†…å®¹å†™å…¥ç®¡é“<br>
![image](https://github.com/LLKI/libevent-/assets/92627079/540db1e9-ab84-483b-ae80-bd23fff053c2)<br>
### ä¿¡å·äº‹ä»¶
åªæœ‰`signalevent.c`è¿™ä¸ªæ–‡ä»¶<br>
å…¶å®ä¸IOäº‹ä»¶ç±»ä¼¼ï¼Œåªæ˜¯å°†IOäº‹ä»¶ä¸­çš„"ç­‰å¾…è¾“å…¥"æ”¹ä¸ºäº†"æ¥æ”¶ä¿¡å·"ï¼Œæ¥æ”¶åˆ°ä¿¡å·çš„æ—¶å€™è°ƒç”¨å›è°ƒå‡½æ•°
![image](https://github.com/LLKI/libevent-/assets/92627079/078e4a72-fcb2-40c6-88b0-bb70079d0555)<br>
#### apiè°ƒç”¨é¡ºåº
1. åˆ›å»ºäº‹ä»¶é›†åˆ(ç¬¬äºŒç§æ–¹æ³•):event_base_new
2. struct event ev:åˆ›å»ºäº‹ä»¶
3. event_assign:åˆå§‹åŒ–äº‹ä»¶
4. event_add:æŠŠäº‹ä»¶æ·»åŠ åˆ°é›†åˆä¸­
5. event_base_dispatch:æŒ‡å®šç›‘å¬çš„äº‹ä»¶é›†åˆ
6. event_base_free:é‡Šæ”¾é›†åˆ
### æœåŠ¡å™¨é«˜å¹¶å‘ç¼–ç¨‹
åœ¨å†™äº†åœ¨å†™äº†ğŸ˜¢
